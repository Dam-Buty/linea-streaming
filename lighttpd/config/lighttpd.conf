server.modules = (
    "mod_access",
    "mod_accesslog",
    "mod_setenv",
    "mod_deflate"
)

server.document-root = "/var/www/localhost/htdocs"
server.port = 80
server.username = "lighttpd"
server.groupname = "lighttpd"

# Logging
server.errorlog = "/var/log/lighttpd/error.log"
accesslog.filename = "/var/log/lighttpd/access.log"

# MIME types
mimetype.assign = (
    ".html" => "text/html",
    ".htm" => "text/html",
    ".txt" => "text/plain",
    ".jpg" => "image/jpeg",
    ".jpeg" => "image/jpeg",
    ".png" => "image/png",
    ".gif" => "image/gif",
    ".css" => "text/css",
    ".js" => "application/javascript",
    ".json" => "application/json",
    ".xml" => "application/xml",
    ".mp4" => "video/mp4",
    ".webm" => "video/webm",
    ".m3u8" => "application/vnd.apple.mpegurl",
    ".ts" => "video/mp2t",
    "" => "application/octet-stream"
)

# Index files
index-file.names = ( "index.html", "index.htm" )

# CORS headers for video streaming
setenv.add-response-header = (
    "Access-Control-Allow-Origin" => "*",
    "Access-Control-Allow-Methods" => "GET, POST, OPTIONS",
    "Access-Control-Allow-Headers" => "Content-Type"
)

# Enable compression for text files
deflate.cache-dir = "/var/cache/lighttpd/compress/"
deflate.mimetypes = (
    "text/html",
    "text/plain",
    "text/css",
    "text/javascript",
    "application/javascript",
    "application/json",
    "application/xml"
)

# URL handling
url.access-deny = ( "~", ".inc" )

# Static file caching
$HTTP["url"] =~ "\.(jpg|jpeg|png|gif|css|js|ico|mp4|webm|m3u8|ts)$" {
    expire.url = ( "" => "access plus 1 hours" )
}

